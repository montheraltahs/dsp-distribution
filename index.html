<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DSP Route Distribution</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .input-section {
            margin-bottom: 20px;
            text-align: center;
        }

        input[type="number"] {
            padding: 8px;
            font-size: 16px;
            width: 100px;
            margin-right: 10px;
        }

        button {
            padding: 8px 16px;
            font-size: 16px;
            background-color: #232F3E;
            color: white;
            border: none;
            border-radius: 4px;
 ;
            cursor: pointer;
            margin: 0 5px;
        }

        button:hover {
            background-color: #37475A;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background-color: #232F3E;
            color: white;
        }

        tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        .next-dsp {
            text-align: center;
            margin-top: 20px;
            font-weight: bold;
            color: #232F3E;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="input-section">
            <input type="number" id id="routeInput" min="1" placeholder="Routes">
            <button onclick="distributeRoutes()">Distribute</button>
            <button onclick="resetRoutes()">Reset</button>
        </div>

        <div class="next-dsp" id="nextDsp"></div>

        <table>
            <thead>
                <tr>
                    <th>DSP Name</th>
                    <th>Extra Routes</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>SONL</td>
                    <td id="sonl-routes">0</td>
                </tr>
                <tr>
                    <td>RURN</td>
                    <td id="rurn-routes">0</td>
                </tr>
                <tr>
                    <td>ALGZ</td>
                    <td id="algz-routes">0</td>
                </tr>
            </tbody>
        </table>
    </div>

    <script>
        // Use a shared key for storing global state
        const GLOBAL_STATE_KEY = 'dsp_global_state';
        const dsps = ['sonl', 'rurn', 'algz'];

        // Function to get global state
        function getGlobalState() {
            const state = localStorage.getItem(GLOBAL_STATE_KEY);
            return state ? JSON.parse(state) : { currentIndex: 0, timestamp: Date.now() };
        }

        // Function to set global state
        function setGlobalState(state) {
            state.timestamp = Date.now();
            localStorage.setItem(GLOBAL_STATE_KEY, JSON.stringify(state));
        }

        // Check for state updates every second
        setInterval(() => {
            const currentState = getGlobalState();
            if (currentState.timestamp > lastCheckTimestamp) {
                currentDspIndex = currentState.currentIndex;
                updateNextDspDisplay();
                lastCheckTimestamp = currentState.timestamp;
            }
        }, 1000);

        let currentDspIndex = getGlobalState().currentIndex;
        let lastCheckTimestamp = Date.now();

        function updateNextDspDisplay() {
            const nextDsp = dsps[currentDspIndex].toUpperCase();
            document.getElementById('nextDsp').textContent = `Next distribution starts with: ${nextDsp}`;
        }

        function distributeRoutes() {
            const routeInpunput = document.getElementById('routeInput');
            const routes = parseInt(routeInput.value);

            if (isNaN(routes) || routes < 1) {
                alert('Please enter a valid number of routes (minimum 1)');
                return;
            }

            // Reset all routes to 0
            dsps.forEach(dsp => {
                document.getElementById(`${dsp}-routes`).textContent = '0';
            });

            let remainingRoutes = routes;
            let distributionIndex = currentDspIndex;

            while (remainingRoutes > 0) {
                const dsp = dsps[distributionIndex];
                const currentValue = parseInt(document.getElementById(`${dsp}-routes`).textContent);
                document.getElementById(`${dsp}-routes`).textContent = currentValue + 1;
                distributionIndex = (distributionIndex + 1) % dsps.length;
                remainingRoutes--;
            }

            // Update the starting point for next distribution
            currentDspIndex = distributionIndex;
            setGlobalState({ currentIndex: currentDspIndex });

            // Update next DSP display
            updateNextDspDisplay();
            
            // Clear input
            routeInput.value = '';
        }

        function resetRoutes() {
            dsps.forEach(dsp => {
                document.getElementById(`${dsp}-routes`).textContent = '0';
            });
            currentDspIndex = 0;
            setGlobalState({ currentIndex: 0 });
            updateNextDspDisplay();
        }

        // Initialize next DSP display when page loads
        updateNextDspDisplay();
    </script>
</body>
</html>
